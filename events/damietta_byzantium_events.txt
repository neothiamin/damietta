############################################
# Events for Byzantium
#
# by neothiamin
############################################

namespace = damietta_byzantium

############################################
# Konstantinos XI
############################################

#Ambitions of Konstantinos XI
#Explains young Konstantinos' desire to be a great warrior, taking the fight to the enemy on the front lines. Byzantium can either choose to let him become a general or tell him no, sparking a self-exile.
country_event = {
	id = damietta_byzantium.1
	title = damietta_byzantium.1.t
	desc = damietta_byzantium.1.desc
	picture = HEIR_AND_FOREIGN_ADVISOR_eventPicture

	trigger = {
		tag = BYZ
		has_heir_flag = damietta_konstantinos_xi
		NOT = {
			is_year = 1455
		}
	}

	fire_only_once = yes

	mean_time_to_happen = {
		months = 60
		modifier = {
			factor = 0.75
			is_at_war = yes
		}
	}

	#Very well, young one. You may lead our forces into victorious battle!
	option = {
		name = damietta_byzantium.1.a
		ai_chance = {
			factor = 25
		}
		define_heir_to_general = {
			fire = 0
			shock = 1
			manuever = 1
			siege = 0
		}
		set_country_flag = damietta_byz_konstantinos_xi_general
	}

	#That's suicide! You shall remain in the Royal Palace.
	option = {
		name = damietta_byzantium.1.b
		ai_chance = {
			factor = 75
		}
		add_prestige = -5
		if = {
			limit = {
				ai = yes
			}
			random_list = {
				20 = {
					custom_tooltip = damietta_konstantinos_mad		
					set_country_flag = damietta_byz_konstantinos_xi_mad
				}
				80 = {
					custom_tooltip = damietta_konstantinos_understands
				}
			}
		}
		else = {
			random_list = {
				75 = {
					custom_tooltip = damietta_konstantinos_mad		
					set_country_flag = damietta_byz_konstantinos_xi_mad
				}
				25 = {
					custom_tooltip = damietta_konstantinos_understands
				}
			}
		}
	}
}

#Disappearance of Heir!
#Looks like Konstantinos got pretty mad and ran off! Uh oh!
country_event = {
	id = damietta_byzantium.2
	title = damietta_byzantium.2.t
	desc = damietta_byzantium.2.desc
	picture = OVEREXTENSION_eventPicture

	fire_only_once = yes

	trigger = {
		had_country_flag = {
			flag = damietta_byz_konstantinos_xi_mad
			days = 730
		}
		has_heir_flag = damietta_konstantinos_xi
		tag = BYZ
	}

	mean_time_to_happen = {
		months = 9
	}

	#Egads!
	option = {
		name = damietta_byzantium.2.a
		add_legitimacy = -25
		exile_heir_as = damietta_byzantium_konstantinos_in_exile
		set_global_flag = damietta_byz_konstantinos_seeking_aid
	}
}

#A Dubious Request
#At this point, Konstantinos goes to the courts of rival nations seeking support for a coup.
country_event = {
	id = damietta_byzantium.3
	title = damietta_byzantium.3.t
	desc = damietta_byzantium.3.desc
	picture = CONQUEST_eventPicture

	trigger = {
		capital_scope = {
			OR = {
				region = anatolia_region
				region = egypt_region
				region = carpathia_region
				region = balkan_region
				region = italy_region
				region = iberia_region
			}
		}
		OR = {
			BYZ = {
				is_rival = ROOT
			}
			is_rival = BYZ
			tag = VEN
			tag = RUM
		}
		total_development = 100
		has_global_flag = damietta_byz_konstantinos_seeking_aid
		NOT = {
			had_global_flag = {
				flag = damietta_byz_konstantinos_seeking_aid
				days = 3650
			}
			has_global_flag = damietta_byz_nation_aided_konstantinos
		}
	}

	mean_time_to_happen = {
		months = 36
	}

	#How malicious! We accept.
	option = {
		name = damietta_byzantium.3.a
		set_country_flag = damietta_supporting_konstantinos_xi
		clr_global_flag = damietta_byz_konstantinos_seeking_aid
		custom_tooltip = damietta_supporting_konstantinos_xi.tt
		set_global_flag = damietta_byz_nation_aided_konstantinos
	}

	#Supporting a pretender? We would never stoop so low!
	option = {
		name = damietta_byzantium.3.b
	}
}

#Konstantinos' Coup (for supporter)
country_event = {
	id = damietta_byzantium.4
	title = damietta_byzantium.4.t
	desc = damietta_byzantium.4.desc
	picture = BYZ_CIVIL_WAR_eventPicture

	trigger = {
		has_country_flag = damietta_supporting_konstantinos_xi
	}

	fire_only_once = yes

	mean_time_to_happen = {
		months = 60
		modifier = {
			factor = 0.8
			BYZ = {
				is_at_war = yes
			}
		}
	}

	#To arms! Down with [BYZ.Monarch.GetName]!
	option = {
		name = damietta_byzantium.4.a
		declare_war_with_cb = {
			casus_belli = damietta_byzantine_coup
			who = BYZ
		}
		BYZ = {
			country_event = {
				id = damietta_byzantium.5
			}
		}
		set_global_flag = damietta_byz_konstantinos_coup
	}
}

#Konstantinos' Coup
country_event = {
	id = damietta_byzantium.5
	title = damietta_byzantium.4.t
	desc = damietta_byzantium.5.desc
	picture = BYZ_CIVIL_WAR_eventPicture

	major = yes

	is_triggered_only = yes

	fire_only_once = yes

	#Oh Konstantinos, my own flesh and blood...
	option = {
		name = damietta_byzantium.5.a
		every_country = {
			limit = {
				has_country_flag = damietta_supporting_konstantinos_xi
			}
			clr_country_flag = damietta_supporting_konstantinos_xi
		}
		add_stability = -1
		random_owned_province = {
			limit = {
				development = 9
			}
			spawn_rebels = {
				size = 2
				type = noble_rebels
			}
		}
		tooltip = {
			FROM = {
				declare_war_with_cb = {
					casus_belli = damietta_byzantine_coup
					who = ROOT
				}
			}
		}
	}
}

############################################
# Co-Emperors
############################################

country_event = {
	id = damietta_byzantium.6
	title = damietta_byzantium.6.t
	desc = damietta_byzantium.6.desc
	picture = THREE_HEIRS_eventPicture

	trigger = {
		tag = BYZ
		has_government_attribute = damietta_byzantium_co_emperors
		OR = {
			AND = {
				has_heir = yes
				NOT = {
					heir_age = 14
				}
				ruler_age = 50
			}
			AND = {
				has_heir = yes
				NOT = {
					heir_adm = 2
				}
				NOT = {
					heir_dip = 2
				}
				NOT = {
					heir_mil = 2
				}
			}
			AND = {
				has_heir = yes
				NOT = {
					heir_claim = 90
				}
			}
			has_heir = no
		}
		NOT = {
			has_ruler_flag = damietta_byzantium_co_emperor_event
		}
	}

	immediate = {
		set_ruler_flag = damietta_byzantium_co_emperor_event
	}

	mean_time_to_happen = {
		months = 240
	}

	#Select one of [Root.Monarch.GetName]'s brothers.
	option = {
		name = damietta_byzantium.6.a
		set_heir_flag = damietta_byzantium_is_co_emperor
		ai_chance = {
			factor = 50
		}
		hidden_effect = {
			exile_heir_as = damietta_byzantium_heir_co_emperor
		}
		define_heir = {
			dynasty = ROOT
			age = 32
			max_random_adm = 2
			max_random_dip = 2
			max_random_mil = 2
			claim = 80
		}
		add_prestige = 5
	}

	#Select a tried and true noble.
	option = {
		name = damietta_byzantium.6.b
		set_heir_flag = damietta_byzantium_is_co_emperor
		ai_chance = {
			factor = 10
		}
		hidden_effect = {
			exile_heir_as = damietta_byzantium_heir_co_emperor
		}
		define_heir = {
			culture = ROOT
			claim = 75
			age = 40
			max_random_adm = 2
			dip = 4
			max_random_mil = 3
		}
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 15
		}
	}

	#Select a famed general.
	option = {
		name = damietta_byzantium.6.c
		set_heir_flag = damietta_byzantium_is_co_emperor
		ai_chance = {
			factor = 10
		}
		hidden_effect = {
			exile_heir_as = damietta_byzantium_heir_co_emperor
		}
		define_heir = {
			culture = ROOT
			claim = 60
			mil = 4
			max_random_dip = 2
			max_random_adm = 3
			age = 30
		}
		#add_mil_power = 50
		hidden_effect = {
			country_event = {
				id = damietta_byzantium.7
				days = 1
			}
		}
	}

	#Select a dear friend.
	option = {
		name = damietta_byzantium.6.d
		set_heir_flag = damietta_byzantium_is_co_emperor
		ai_chance = {
			factor = 5
		}
		hidden_effect = {
			exile_heir_as = damietta_byzantium_heir_co_emperor
		}
		define_heir = {
			culture = ROOT
			claim = 65
			adm = 4
			max_random_dip = 3
			max_random_mil = 2
			age = 40
		}
		add_dip_power = 25
	}

	#Continue with the current plan.
	option = {
		name = damietta_byzantium.6.e
		ai_chance = {
			factor = 25
		}
		add_legitimacy = -10
	}
}

#Converts heir to general
country_event = {
	id = damietta_byzantium.7
	#title = damietta_byzantium.7.t
	#desc = damietta_byzantium.7.desc
	picture = THREE_HEIRS_eventPicture
	
	hidden = yes

	is_triggered_only = yes


	immediate = {
		define_heir_to_general = {
			fire = 1
			shock = 3
			manuever = 2
			siege = 1
		}
	}

	option = {
		ai_chance = {
			factor = 100
		}
	}
}

#removes coup CB
country_event = {
	id = damietta_byzantium.8
	#title = damietta_byzantium.8.t
	#desc = damietta_byzantium.8.desc
	picture = THREE_HEIRS_eventPicture
	
	hidden = yes
	
	trigger = {
		#has_country_flag = damietta_supporting_konstantinos_xi
		truce_with = BYZ
		has_casus_belli = {
			type = damietta_byzantine_coup
			target = BYZ
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		remove_casus_belli = {
			type = damietta_byzantine_coup
			target = BYZ
		}
	}

	option = {
	}
}

############################################
# Siege of Constantinople
############################################

country_event = {
	id = damietta_byzantium.9
	title = damietta_byzantium.9.t
	desc = damietta_byzantium.9.desc
	picture = VILLAGE_BURNING_eventPicture

	is_triggered_only = yes

	fire_only_once = yes

	trigger = {
		NOT = {
			religion = BYZ
		}
		FROM = {
			province_id = 151
			owner = {
				tag = BYZ
				religion = orthodox
			}
		}		
	}

	#Burn it down!
	option = {
		name = damietta_byzantium.9.a
		151 = {
			add_base_manpower = -3
			add_base_tax = -3
			add_base_production = -3	
			add_loot_from_rich_province_general_effect = {
				LOOTER = ROOT
			}			
			add_province_modifier = {
				name = damietta_constantinople_sacked
				duration = 9125
			}
		}
	}

	#Leave most of the buildings standing, but pillage the churches and palaces.
	option = {
		name = damietta_byzantium.9.b
		151 = {
			add_base_manpower = -2
			add_base_tax = -2
			add_base_production =-2
			add_devastation = 25
			add_province_modifier = {
				name = damietta_constantinople_sacked
				duration = 3650
			}
		}
		capital_scope = {
			add_base_manpower = 1
			add_base_tax = 1
			add_base_production = 1
		}
	}
}